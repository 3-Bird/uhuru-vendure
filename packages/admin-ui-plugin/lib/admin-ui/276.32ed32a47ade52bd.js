"use strict";(self.webpackChunkvendure_admin=self.webpackChunkvendure_admin||[]).push([[276],{4276:(Yt,F,a)=>{a.r(F),a.d(F,{GET_PROMOTION_DETAIL:()=>pt,GET_PROMOTION_LIST:()=>Mt,MarketingModule:()=>g,PromotionDetailComponent:()=>h,PromotionListComponent:()=>v,assignPromotionsToChannelBulkAction:()=>G,createRoutes:()=>j,deletePromotionsBulkAction:()=>R,duplicatePromotionsBulkAction:()=>N,promotionBreadcrumb:()=>Ot,removePromotionsFromChannelBulkAction:()=>L});var l=a(1259),d=a(6286),s=a(1582),b=a(937),E=a(282),M=a(1451),O=a(483),t=a(6504),f=a(2232),p=a(4739),u=a(8074),_=a(3766),Y=a(50),B=a(1548),S=a(4538),y=a(9356),U=a(2906),x=a(3120),V=a(568),X=a(6515),J=a(9430),k=a(4299),D=a(6292),H=a(4400),w=a(3394),K=a(2910),A=a(5888),Z=a(1998),Q=a(1002),z=a(520),W=a(1646),$=a(1149),q=a(5505);function tt(e,o){if(1&e){const n=t.RV6();t.j41(0,"button",27),t.bIt("click",function(){t.eBV(n);const r=t.XpG();return t.Njj(r.create())}),t.EFF(1),t.nI1(2,"translate"),t.k0s()}if(2&e){const n=t.XpG();t.Y8G("disabled",!n.saveButtonEnabled()),t.R7$(),t.SpI(" ",t.bMT(2,2,"common.create")," ")}}function ot(e,o){if(1&e){const n=t.RV6();t.j41(0,"button",27),t.bIt("click",function(){t.eBV(n);const r=t.XpG(2);return t.Njj(r.save())}),t.EFF(1),t.nI1(2,"translate"),t.k0s()}if(2&e){const n=t.XpG(2);t.Y8G("disabled",!n.saveButtonEnabled()),t.R7$(),t.SpI(" ",t.bMT(2,2,"common.update")," ")}}function nt(e,o){1&e&&t.DNE(0,ot,3,4,"button",28),2&e&&t.Y8G("vdrIfPermissions","UpdatePromotion")}function et(e,o){1&e&&(t.j41(0,"vdr-card")(1,"clr-toggle-wrapper"),t.nrm(2,"input",29),t.j41(3,"label"),t.EFF(4),t.nI1(5,"translate"),t.k0s()()()),2&e&&(t.R7$(4),t.JRh(t.bMT(5,1,"common.enabled")))}function it(e,o){if(1&e&&(t.j41(0,"vdr-card"),t.nrm(1,"vdr-page-entity-info",30),t.k0s()),2&e){const n=o.ngIf;t.R7$(),t.Y8G("entity",n)}}function rt(e,o){if(1&e&&(t.j41(0,"vdr-card",31),t.nI1(1,"translate"),t.nrm(2,"vdr-tabbed-custom-fields",32),t.nI1(3,"hasPermission"),t.k0s()),2&e){const n=t.XpG();t.Y8G("title",t.bMT(1,4,"common.custom-fields")),t.R7$(2),t.Y8G("customFields",n.customFields)("customFieldsFormGroup",n.detailForm.get("customFields"))("readonly",!t.bMT(3,6,"UpdatePromotion"))}}function at(e,o){if(1&e){const n=t.RV6();t.j41(0,"div")(1,"vdr-configurable-input",33),t.nI1(2,"hasPermission"),t.bIt("remove",function(r){t.eBV(n);const m=t.XpG();return t.Njj(m.removeCondition(r))}),t.k0s()()}if(2&e){const n=o.$implicit,i=o.index,r=t.XpG();t.R7$(),t.Y8G("position",i)("readonly",!t.bMT(2,5,"UpdatePromotion"))("operation",n)("operationDefinition",r.getConditionDefinition(n))("formControlName",i)}}function st(e,o){if(1&e){const n=t.RV6();t.j41(0,"button",38),t.bIt("click",function(){const r=t.eBV(n).$implicit,m=t.XpG(2);return t.Njj(m.addCondition(r))}),t.EFF(1),t.k0s()}if(2&e){const n=o.$implicit;t.R7$(),t.SpI(" ",n.description," ")}}function mt(e,o){if(1&e&&(t.j41(0,"vdr-dropdown")(1,"button",34),t.nrm(2,"clr-icon",35),t.EFF(3),t.nI1(4,"translate"),t.k0s(),t.j41(5,"vdr-dropdown-menu",36),t.DNE(6,st,2,1,"button",37),t.k0s()()),2&e){const n=t.XpG();t.R7$(3),t.SpI(" ",t.bMT(4,2,"marketing.add-condition")," "),t.R7$(3),t.Y8G("ngForOf",n.getAvailableConditions())}}function dt(e,o){if(1&e){const n=t.RV6();t.j41(0,"div")(1,"vdr-configurable-input",39),t.nI1(2,"hasPermission"),t.bIt("remove",function(r){t.eBV(n);const m=t.XpG();return t.Njj(m.removeAction(r))}),t.k0s()()}if(2&e){const n=o.$implicit,i=o.index,r=t.XpG();t.R7$(),t.Y8G("position",i)("operation",n)("readonly",!t.bMT(2,5,"UpdatePromotion"))("operationDefinition",r.getActionDefinition(n))("formControlName",i)}}function lt(e,o){if(1&e){const n=t.RV6();t.j41(0,"button",38),t.bIt("click",function(){const r=t.eBV(n).$implicit,m=t.XpG(2);return t.Njj(m.addAction(r))}),t.EFF(1),t.k0s()}if(2&e){const n=o.$implicit;t.R7$(),t.SpI(" ",n.description," ")}}function ct(e,o){if(1&e&&(t.j41(0,"vdr-dropdown")(1,"button",34),t.nrm(2,"clr-icon",35),t.EFF(3),t.nI1(4,"translate"),t.k0s(),t.j41(5,"vdr-dropdown-menu",36),t.DNE(6,lt,2,1,"button",37),t.k0s()()),2&e){const n=t.XpG();t.R7$(3),t.SpI(" ",t.bMT(4,2,"marketing.add-action")," "),t.R7$(3),t.Y8G("ngForOf",n.getAvailableActions())}}const pt=b.J1`
    query GetPromotionDetail($id: ID!) {
        promotion(id: $id) {
            ...Promotion
        }
    }
    ${s.DOi}
`;class h extends s.wi7{constructor(o,n,i,r){super(),this.changeDetector=o,this.dataService=n,this.formBuilder=i,this.notificationService=r,this.customFields=this.getCustomFieldConfig("Promotion"),this.detailForm=this.formBuilder.group({name:["",l.k0.required],description:"",enabled:!0,couponCode:null,perCustomerUsageLimit:null,usageLimit:null,startsAt:null,endsAt:null,conditions:this.formBuilder.array([]),actions:this.formBuilder.array([]),customFields:this.formBuilder.group((0,s.HCD)(this.customFields))}),this.conditions=[],this.actions=[],this.allConditions=[],this.allActions=[],this.customFields=this.getCustomFieldConfig("Promotion")}ngOnInit(){this.init(),this.dataService.promotion.getPromotionActionsAndConditions().single$.subscribe(o=>{this.allActions=o.promotionActions,this.allConditions=o.promotionConditions,this.changeDetector.markForCheck()})}ngOnDestroy(){this.destroy()}getAvailableConditions(){return this.allConditions.filter(o=>!this.conditions.find(n=>n.code===o.code))}getConditionDefinition(o){return this.allConditions.find(n=>n.code===o.code)}getAvailableActions(){return this.allActions.filter(o=>!this.actions.find(n=>n.code===o.code))}getActionDefinition(o){return this.allActions.find(n=>n.code===o.code)}saveButtonEnabled(){return!(!this.detailForm.dirty||!this.detailForm.valid||0===this.conditions.length&&!this.detailForm.value.couponCode||0===this.actions.length)}addCondition(o){this.addOperation("conditions",o),this.detailForm.markAsDirty()}addAction(o){this.addOperation("actions",o),this.detailForm.markAsDirty()}removeCondition(o){this.removeOperation("conditions",o),this.detailForm.markAsDirty()}removeAction(o){this.removeOperation("actions",o),this.detailForm.markAsDirty()}formArrayOf(o){return this.detailForm.get(o)}create(){if(!this.detailForm.dirty)return;const o=this.getUpdatedPromotion({id:"",createdAt:"",updatedAt:"",startsAt:"",endsAt:"",name:"",description:"",couponCode:null,perCustomerUsageLimit:null,usageLimit:null,enabled:!1,conditions:[],actions:[],translations:[]},this.detailForm,this.languageCode);this.dataService.promotion.createPromotion(o).subscribe(({createPromotion:n})=>{switch(n.__typename){case"Promotion":this.notificationService.success((0,d.x)("common.notify-create-success"),{entity:"Promotion"}),this.detailForm.markAsPristine(),this.changeDetector.markForCheck(),this.router.navigate(["../",n.id],{relativeTo:this.route});break;case"MissingConditionsError":this.notificationService.error(n.message)}},n=>{this.notificationService.error((0,d.x)("common.notify-create-error"),{entity:"Promotion"})})}save(){this.detailForm.dirty&&(0,E.z)(this.entity$,this.languageCode$).pipe((0,M.s)(1),(0,O.Z)(([o,n])=>{const i=this.getUpdatedPromotion(o,this.detailForm,n);return this.dataService.promotion.updatePromotion(i)})).subscribe(o=>{this.notificationService.success((0,d.x)("common.notify-update-success"),{entity:"Promotion"}),this.detailForm.markAsPristine(),this.changeDetector.markForCheck()},o=>{this.notificationService.error((0,d.x)("common.notify-update-error"),{entity:"Promotion"})})}getUpdatedPromotion(o,n,i){const r=n.value;return{...(0,s.vk6)({translatable:o,updatedFields:r,customFieldConfig:this.customFields,languageCode:i,defaultTranslation:{languageCode:i,name:o.name||"",description:o.description||""}}),conditions:this.mapOperationsToInputs(this.conditions,r.conditions),actions:this.mapOperationsToInputs(this.actions,r.actions)}}setFormValues(o,n){const i=(0,s.RMk)(o,n);this.detailForm.patchValue({name:i?.name,description:i?.description,enabled:o.enabled,couponCode:o.couponCode,perCustomerUsageLimit:o.perCustomerUsageLimit,usageLimit:o.usageLimit,startsAt:o.startsAt,endsAt:o.endsAt}),o.conditions.forEach(r=>{this.addOperation("conditions",r)}),o.actions.forEach(r=>this.addOperation("actions",r)),this.customFields.length&&this.setCustomFieldFormValues(this.customFields,this.detailForm.get("customFields"),o,i)}mapOperationsToInputs(o,n){return o.map((i,r)=>({code:i.code,arguments:Object.values(n[r].args).map((m,c)=>({name:i.args[c].name,value:(0,s.CS_)(m)}))}))}addOperation(o,n){const i=this.formArrayOf(o),r="conditions"===o?this.conditions:this.actions;if(-1===i.value.findIndex(c=>c.code===n.code)){const c=n.args.reduce((C,I)=>({...C,[I.name]:(0,s.gfn)(I.value)??this.getDefaultArgValue(o,n,I.name)}),{});i.push(this.formBuilder.control({code:n.code,args:c})),r.push({code:n.code,args:n.args.map(C=>({name:C.name,value:(0,s.gfn)(C.value)}))})}}getDefaultArgValue(o,n,i){const r="conditions"===o?this.allConditions.find(m=>m.code===n.code):this.allActions.find(m=>m.code===n.code);if(r){const m=r.args.find(c=>c.name===i);if(m)return(0,s.NPj)(m)}throw new Error('Could not determine default value for "argName"')}removeOperation(o,n){const i=this.formArrayOf(o),r="conditions"===o?this.conditions:this.actions,m=i.value.findIndex(c=>c.code===n.code);-1!==m&&(i.removeAt(m),r.splice(m,1))}static#t=this.\u0275fac=function(n){return new(n||h)(t.rXU(t.gRc),t.rXU(s.uSP),t.rXU(l.ok),t.rXU(s.JEu))};static#o=this.\u0275cmp=t.VBU({type:h,selectors:[["vdr-promotion-detail"]],features:[t.Vt3],decls:63,vars:73,consts:[["updateButton",""],[1,"flex","clr-align-items-center"],[3,"languageCodeChange","disabled","availableLanguageCodes","currentLanguageCode"],["locationId","promotion-detail"],["class","btn btn-primary",3,"disabled","click",4,"ngIf","ngIfElse"],[1,"form",3,"formGroup"],[4,"vdrIfPermissions"],[4,"ngIf"],[1,"form-grid"],["for","name",3,"label"],["id","name","type","text","formControlName","name",3,"readonly"],["formControlName","description",1,"form-grid-span",3,"readonly","label"],["for","startsAt",3,"label"],["formControlName","startsAt"],["for","endsAt",3,"label"],["formControlName","endsAt"],["for","couponCode",3,"label"],["id","couponCode","type","text","formControlName","couponCode",3,"readonly"],["for","perCustomerUsageLimit",3,"label","tooltip"],["id","perCustomerUsageLimit","type","number","min","1","max","999","formControlName","perCustomerUsageLimit",3,"readonly"],["for","usageLimit",3,"label","tooltip"],["id","usageLimit","type","number","min","1","max","9999999","formControlName","usageLimit",3,"readonly"],["formGroupName","customFields",3,"title",4,"ngIf"],["locationId","promotion-detail",3,"entity$","detailForm"],["formArrayName","conditions",3,"title"],[4,"ngFor","ngForOf"],["formArrayName","actions",3,"title"],[1,"btn","btn-primary",3,"click","disabled"],["class","btn btn-primary",3,"disabled","click",4,"vdrIfPermissions"],["type","checkbox","clrToggle","","name","enabled","formControlName","enabled"],[3,"entity"],["formGroupName","customFields",3,"title"],["entityName","Promotion",3,"customFields","customFieldsFormGroup","readonly"],[3,"remove","position","readonly","operation","operationDefinition","formControlName"],["vdrDropdownTrigger","",1,"btn","btn-outline"],["shape","plus"],["vdrPosition","bottom-left"],["type","button","vdrDropdownItem","","class","item-wrap",3,"click",4,"ngFor","ngForOf"],["type","button","vdrDropdownItem","",1,"item-wrap",3,"click"],[3,"remove","position","operation","readonly","operationDefinition","formControlName"]],template:function(n,i){if(1&n){const r=t.RV6();t.j41(0,"vdr-page-block")(1,"vdr-action-bar")(2,"vdr-ab-left")(3,"div",1)(4,"vdr-language-selector",2),t.nI1(5,"async"),t.nI1(6,"async"),t.nI1(7,"async"),t.bIt("languageCodeChange",function(c){return t.eBV(r),t.Njj(i.setLanguage(c))}),t.k0s()()(),t.j41(8,"vdr-ab-right"),t.nrm(9,"vdr-action-bar-items",3),t.DNE(10,tt,3,4,"button",4),t.nI1(11,"async"),t.DNE(12,nt,1,1,"ng-template",null,0,t.C5r),t.nrm(14,"vdr-action-bar-dropdown-menu",3),t.k0s()()(),t.j41(15,"form",5)(16,"vdr-page-detail-layout")(17,"vdr-page-detail-sidebar"),t.DNE(18,et,6,3,"vdr-card",6)(19,it,2,1,"vdr-card",7),t.nI1(20,"async"),t.k0s(),t.j41(21,"vdr-page-block")(22,"vdr-card")(23,"div",8)(24,"vdr-form-field",9),t.nI1(25,"translate"),t.nrm(26,"input",10),t.nI1(27,"hasPermission"),t.k0s(),t.nrm(28,"vdr-rich-text-editor",11),t.nI1(29,"hasPermission"),t.nI1(30,"translate"),t.j41(31,"vdr-form-field",12),t.nI1(32,"translate"),t.nrm(33,"vdr-datetime-picker",13),t.k0s(),t.j41(34,"vdr-form-field",14),t.nI1(35,"translate"),t.nrm(36,"vdr-datetime-picker",15),t.k0s(),t.j41(37,"vdr-form-field",16),t.nI1(38,"translate"),t.nrm(39,"input",17),t.nI1(40,"hasPermission"),t.k0s(),t.j41(41,"vdr-form-field",18),t.nI1(42,"translate"),t.nI1(43,"translate"),t.nrm(44,"input",19),t.nI1(45,"hasPermission"),t.k0s(),t.j41(46,"vdr-form-field",20),t.nI1(47,"translate"),t.nI1(48,"translate"),t.nrm(49,"input",21),t.nI1(50,"hasPermission"),t.k0s()()(),t.DNE(51,rt,4,8,"vdr-card",22),t.nrm(52,"vdr-custom-detail-component-host",23),t.j41(53,"vdr-card",24),t.nI1(54,"translate"),t.DNE(55,at,3,7,"div",25),t.j41(56,"div"),t.DNE(57,mt,7,4,"vdr-dropdown",6),t.k0s()(),t.j41(58,"vdr-card",26),t.nI1(59,"translate"),t.DNE(60,dt,3,7,"div",25),t.j41(61,"div"),t.DNE(62,ct,7,4,"vdr-dropdown",6),t.k0s()()()()()}if(2&n){const r=t.sdS(13);t.R7$(4),t.Y8G("disabled",t.bMT(5,31,i.isNew$))("availableLanguageCodes",t.bMT(6,33,i.availableLanguages$))("currentLanguageCode",t.bMT(7,35,i.languageCode$)),t.R7$(6),t.Y8G("ngIf",t.bMT(11,37,i.isNew$))("ngIfElse",r),t.R7$(5),t.Y8G("formGroup",i.detailForm),t.R7$(3),t.Y8G("vdrIfPermissions","UpdatePromotion"),t.R7$(),t.Y8G("ngIf",t.bMT(20,39,i.entity$)),t.R7$(5),t.Y8G("label",t.bMT(25,41,"common.name")),t.R7$(2),t.Y8G("readonly",!t.bMT(27,43,"UpdatePromotion")),t.R7$(2),t.Y8G("readonly",!t.bMT(29,45,"UpdatePromotion"))("label",t.bMT(30,47,"common.description")),t.R7$(3),t.Y8G("label",t.bMT(32,49,"marketing.starts-at")),t.R7$(3),t.Y8G("label",t.bMT(35,51,"marketing.ends-at")),t.R7$(3),t.Y8G("label",t.bMT(38,53,"marketing.coupon-code")),t.R7$(2),t.Y8G("readonly",!t.bMT(40,55,"UpdatePromotion")),t.R7$(2),t.Y8G("label",t.bMT(42,57,"marketing.per-customer-limit"))("tooltip",t.bMT(43,59,"marketing.per-customer-limit-tooltip")),t.R7$(3),t.Y8G("readonly",!t.bMT(45,61,"UpdatePromotion")),t.R7$(2),t.Y8G("label",t.bMT(47,63,"marketing.usage-limit"))("tooltip",t.bMT(48,65,"marketing.usage-limit-tooltip")),t.R7$(3),t.Y8G("readonly",!t.bMT(50,67,"UpdatePromotion")),t.R7$(2),t.Y8G("ngIf",i.customFields.length),t.R7$(),t.Y8G("entity$",i.entity$)("detailForm",i.detailForm),t.R7$(),t.Y8G("title",t.bMT(54,69,"marketing.conditions")),t.R7$(2),t.Y8G("ngForOf",i.conditions),t.R7$(2),t.Y8G("vdrIfPermissions","UpdatePromotion"),t.R7$(),t.Y8G("title",t.bMT(59,71,"marketing.actions")),t.R7$(2),t.Y8G("ngForOf",i.actions),t.R7$(2),t.Y8G("vdrIfPermissions","UpdatePromotion")}},dependencies:[f.U4n,f.aZZ,f.Jej,f.eAx,p.Sq,p.bT,l.qT,l.me,l.Q0,l.Zm,l.BC,l.cb,l.VZ,l.zX,l.j4,l.JD,l.$R,l.v8,u.nG,u.wL,u.TX,_.l,Y.h,B.K,S.V,y.t,U.q,x.P,V.q,X.j,J.M,k.p,D.T,H.j,w.W,K.L,A.e,Z.E,Q.c,z.e,W.i,p.Jj,$.D9,q.E],styles:[".item-wrap[_ngcontent-%COMP%]{white-space:normal}"],changeDetection:0})}var P=a(1044);b.J1`
    mutation AssignPromotionsToChannel($input: AssignPromotionsToChannelInput!) {
        assignPromotionsToChannel(input: $input) {
            id
            name
        }
    }
`,b.J1`
    mutation RemovePromotionsFromChannel($input: RemovePromotionsFromChannelInput!) {
        removePromotionsFromChannel(input: $input) {
            id
            name
        }
    }
`;const R=(0,s.AfA)({location:"promotion-list",requiresPermission:s.aXG.DeletePromotion,getItemName:e=>e.name,bulkDelete:(e,o)=>e.promotion.deletePromotions(o).pipe((0,P.T)(n=>n.deletePromotions))}),G=(0,s.oUe)({location:"promotion-list",requiresPermission:s.aXG.UpdatePromotion,getItemName:e=>e.name,bulkAssignToChannel:(e,o,n)=>n.map(i=>e.mutate(s.dbM,{input:{channelId:i,promotionIds:o}}).pipe((0,P.T)(r=>r.assignPromotionsToChannel)))}),L=(0,s.YSJ)({location:"promotion-list",requiresPermission:s.aXG.DeleteCatalog,getItemName:e=>e.name,bulkRemoveFromChannel:(e,o,n)=>e.mutate(s.Bn2,{input:{channelId:n,promotionIds:o}}).pipe((0,P.T)(i=>i.removePromotionsFromChannel))}),N={location:"promotion-list",label:(0,d.x)("common.duplicate"),icon:"copy",onClick:({injector:e,selection:o,hostComponent:n,clearSelection:i})=>{e.get(s.Bg8).fromComponent(s.MPR,{locals:{entities:o,entityName:"Promotion",title:(0,d.x)("marketing.duplicate-promotions"),getEntityName:m=>m.name}}).subscribe(m=>{m&&(i(),n.refresh())})}};var T=a(1894),ut=a(7482),gt=a(5916),ft=a(4709),ht=a(3202),vt=a(4764),bt=a(3987),Ct=a(1470);const Pt=()=>["./create"],Tt=e=>["./",e];function It(e,o){1&e&&(t.j41(0,"a",17),t.nrm(1,"clr-icon",18),t.EFF(2),t.nI1(3,"translate"),t.k0s()),2&e&&(t.Y8G("routerLink",t.lJ4(4,Pt)),t.R7$(2),t.SpI(" ",t.bMT(3,2,"marketing.create-new-promotion")," "))}function Ft(e,o){if(1&e&&t.EFF(0),2&e){const n=o.item;t.JRh(n.id)}}function _t(e,o){if(1&e&&(t.EFF(0),t.nI1(1,"localeDate")),2&e){const n=o.item;t.SpI(" ",t.i5U(1,1,n.createdAt,"short")," ")}}function yt(e,o){if(1&e&&(t.EFF(0),t.nI1(1,"localeDate")),2&e){const n=o.item;t.SpI(" ",t.i5U(1,1,n.updatedAt,"short")," ")}}function kt(e,o){if(1&e&&(t.j41(0,"a",19)(1,"span"),t.EFF(2),t.k0s(),t.nrm(3,"clr-icon",20),t.k0s()),2&e){const n=o.item;t.Y8G("routerLink",t.eq3(2,Tt,n.id)),t.R7$(2),t.SpI(" ",n.name,"")}}function Dt(e,o){1&e&&(t.j41(0,"vdr-chip",23),t.EFF(1),t.nI1(2,"translate"),t.k0s()),2&e&&(t.R7$(),t.JRh(t.bMT(2,1,"common.enabled")))}function At(e,o){1&e&&(t.j41(0,"vdr-chip",24),t.EFF(1),t.nI1(2,"translate"),t.k0s()),2&e&&(t.R7$(),t.JRh(t.bMT(2,1,"common.disabled")))}function $t(e,o){if(1&e&&t.DNE(0,Dt,3,3,"vdr-chip",21)(1,At,3,3,"vdr-chip",22),2&e){const n=o.item;t.Y8G("ngIf",n.enabled),t.R7$(),t.Y8G("ngIf",!n.enabled)}}function Rt(e,o){if(1&e&&t.EFF(0),2&e){const n=o.item;t.SpI(" ",n.couponCode," ")}}function Gt(e,o){if(1&e&&(t.EFF(0),t.nI1(1,"localeDate")),2&e){const n=o.item;t.SpI(" ",t.i5U(1,1,n.startsAt,"short")," ")}}function Lt(e,o){if(1&e&&(t.EFF(0),t.nI1(1,"localeDate")),2&e){const n=o.item;t.SpI(" ",t.i5U(1,1,n.endsAt,"short")," ")}}function Nt(e,o){if(1&e&&t.EFF(0),2&e){const n=o.item;t.SpI(" ",n.perCustomerUsageLimit," ")}}function jt(e,o){if(1&e&&t.EFF(0),2&e){const n=o.item;t.SpI(" ",n.usageLimit," ")}}function Et(e,o){if(1&e&&t.nrm(0,"vdr-dt2-custom-field-column",25),2&e){const n=o.$implicit,i=t.XpG();t.Y8G("customField",n)("sorts",i.sorts)}}const Mt=b.J1`
    query GetPromotionList($options: PromotionListOptions) {
        promotions(options: $options) {
            items {
                ...Promotion
            }
            totalItems
        }
    }
    ${s.DOi}
`;class v extends s.B8I{constructor(){super(),this.customFields=this.getCustomFieldConfig("Promotion"),this.filters=this.createFilterCollection().addIdFilter().addDateFilters().addFilters([{name:"startsAt",type:{kind:"dateRange"},label:(0,d.x)("marketing.starts-at"),filterField:"startsAt"},{name:"endsAt",type:{kind:"dateRange"},label:(0,d.x)("marketing.ends-at"),filterField:"endsAt"},{name:"enabled",type:{kind:"boolean"},label:(0,d.x)("common.enabled"),filterField:"enabled"},{name:"name",type:{kind:"text"},label:(0,d.x)("common.name"),filterField:"name"},{name:"couponCode",type:{kind:"text"},label:(0,d.x)("marketing.coupon-code"),filterField:"couponCode"},{name:"desc",type:{kind:"text"},label:(0,d.x)("common.description"),filterField:"description"},{name:"perCustomerUsageLimit",type:{kind:"number"},label:(0,d.x)("marketing.per-customer-limit"),filterField:"perCustomerUsageLimit"},{name:"usageLimit",type:{kind:"number"},label:(0,d.x)("marketing.usage-limit"),filterField:"usageLimit"}]).addCustomFieldFilters(this.customFields).connectToRoute(this.route),this.sorts=this.createSortCollection().defaultSort("createdAt","DESC").addSorts([{name:"createdAt"},{name:"updatedAt"},{name:"startsAt"},{name:"endsAt"},{name:"name"},{name:"couponCode"},{name:"perCustomerUsageLimit"},{name:"usageLimit"}]).addCustomFieldSorts(this.customFields).connectToRoute(this.route),super.configure({document:s.dcS,getItems:o=>o.promotions,setVariables:(o,n)=>this.createQueryOptions(o,n,this.searchTermControl.value),refreshListOnChanges:[this.filters.valueChanges,this.sorts.valueChanges]})}createQueryOptions(o,n,i){const r=this.filters.createFilterInput(),m=this.sorts.createSortInput();let c=s.umn.AND;return i&&(r.couponCode={contains:i},r.name={contains:i},c=s.umn.OR),{options:{skip:o,take:n,filter:r,filterOperator:c,sort:m}}}static#t=this.\u0275fac=function(n){return new(n||v)};static#o=this.\u0275cmp=t.VBU({type:v,selectors:[["vdr-promotion-list"]],features:[t.Vt3],decls:49,vars:71,consts:[[3,"languageCodeChange","availableLanguageCodes","currentLanguageCode"],["locationId","promotion-list"],["class","btn btn-primary",3,"routerLink",4,"vdrIfPermissions"],["id","promotion-list",3,"pageChange","itemsPerPageChange","items","itemsPerPage","totalItems","currentPage","filters"],["locationId","promotion-list",3,"hostComponent","selectionManager"],[3,"searchTermControl","searchTermPlaceholder"],["id","id",3,"heading","hiddenByDefault"],["id","created-at",3,"heading","hiddenByDefault","sort"],["id","updated-at",3,"heading","hiddenByDefault","sort"],["id","name",3,"heading","optional","sort"],["id","enabled",3,"heading"],["id","coupon-code",3,"heading","sort"],["id","starts-at",3,"heading","sort"],["id","ends-at",3,"heading","sort"],["id","per-customer-limit",3,"heading","sort","hiddenByDefault"],["id","usage-limit",3,"heading","sort","hiddenByDefault"],[3,"customField","sorts",4,"ngFor","ngForOf"],[1,"btn","btn-primary",3,"routerLink"],["shape","plus"],[1,"button-ghost",3,"routerLink"],["shape","arrow right"],["colorType","success",4,"ngIf"],["colorType","warning",4,"ngIf"],["colorType","success"],["colorType","warning"],[3,"customField","sorts"]],template:function(n,i){1&n&&(t.j41(0,"vdr-page-block")(1,"vdr-action-bar")(2,"vdr-ab-left")(3,"vdr-language-selector",0),t.nI1(4,"async"),t.nI1(5,"async"),t.bIt("languageCodeChange",function(m){return i.setLanguage(m)}),t.k0s()(),t.j41(6,"vdr-ab-right"),t.nrm(7,"vdr-action-bar-items",1),t.DNE(8,It,4,5,"a",2),t.nrm(9,"vdr-action-bar-dropdown-menu",1),t.k0s()()(),t.j41(10,"vdr-data-table-2",3),t.nI1(11,"async"),t.nI1(12,"async"),t.nI1(13,"async"),t.nI1(14,"async"),t.bIt("pageChange",function(m){return i.setPageNumber(m)})("itemsPerPageChange",function(m){return i.setItemsPerPage(m)}),t.nrm(15,"vdr-bulk-action-menu",4)(16,"vdr-dt2-search",5),t.nI1(17,"translate"),t.j41(18,"vdr-dt2-column",6),t.nI1(19,"translate"),t.DNE(20,Ft,1,1,"ng-template"),t.k0s(),t.j41(21,"vdr-dt2-column",7),t.nI1(22,"translate"),t.DNE(23,_t,2,4,"ng-template"),t.k0s(),t.j41(24,"vdr-dt2-column",8),t.nI1(25,"translate"),t.DNE(26,yt,2,4,"ng-template"),t.k0s(),t.j41(27,"vdr-dt2-column",9),t.nI1(28,"translate"),t.DNE(29,kt,4,4,"ng-template"),t.k0s(),t.j41(30,"vdr-dt2-column",10),t.nI1(31,"translate"),t.DNE(32,$t,2,2,"ng-template"),t.k0s(),t.j41(33,"vdr-dt2-column",11),t.nI1(34,"translate"),t.DNE(35,Rt,1,1,"ng-template"),t.k0s(),t.j41(36,"vdr-dt2-column",12),t.nI1(37,"translate"),t.DNE(38,Gt,2,4,"ng-template"),t.k0s(),t.j41(39,"vdr-dt2-column",13),t.nI1(40,"translate"),t.DNE(41,Lt,2,4,"ng-template"),t.k0s(),t.j41(42,"vdr-dt2-column",14),t.nI1(43,"translate"),t.DNE(44,Nt,1,1,"ng-template"),t.k0s(),t.j41(45,"vdr-dt2-column",15),t.nI1(46,"translate"),t.DNE(47,jt,1,1,"ng-template"),t.k0s(),t.DNE(48,Et,1,2,"vdr-dt2-custom-field-column",16),t.k0s()),2&n&&(t.R7$(3),t.Y8G("availableLanguageCodes",t.bMT(4,37,i.availableLanguages$))("currentLanguageCode",t.bMT(5,39,i.contentLanguage$)),t.R7$(5),t.Y8G("vdrIfPermissions","CreatePromotion"),t.R7$(2),t.Y8G("items",t.bMT(11,41,i.items$))("itemsPerPage",t.bMT(12,43,i.itemsPerPage$))("totalItems",t.bMT(13,45,i.totalItems$))("currentPage",t.bMT(14,47,i.currentPage$))("filters",i.filters),t.R7$(5),t.Y8G("hostComponent",i)("selectionManager",i.selectionManager),t.R7$(),t.Y8G("searchTermControl",i.searchTermControl)("searchTermPlaceholder",t.bMT(17,49,"marketing.search-by-name-or-coupon-code")),t.R7$(2),t.Y8G("heading",t.bMT(19,51,"common.id"))("hiddenByDefault",!0),t.R7$(3),t.Y8G("heading",t.bMT(22,53,"common.created-at"))("hiddenByDefault",!0)("sort",i.sorts.get("createdAt")),t.R7$(3),t.Y8G("heading",t.bMT(25,55,"common.updated-at"))("hiddenByDefault",!0)("sort",i.sorts.get("updatedAt")),t.R7$(3),t.Y8G("heading",t.bMT(28,57,"common.name"))("optional",!1)("sort",i.sorts.get("name")),t.R7$(3),t.Y8G("heading",t.bMT(31,59,"common.enabled")),t.R7$(3),t.Y8G("heading",t.bMT(34,61,"marketing.coupon-code"))("sort",i.sorts.get("couponCode")),t.R7$(3),t.Y8G("heading",t.bMT(37,63,"marketing.starts-at"))("sort",i.sorts.get("startsAt")),t.R7$(3),t.Y8G("heading",t.bMT(40,65,"marketing.ends-at"))("sort",i.sorts.get("endsAt")),t.R7$(3),t.Y8G("heading",t.bMT(43,67,"marketing.per-customer-limit"))("sort",i.sorts.get("perCustomerUsageLimit"))("hiddenByDefault",!0),t.R7$(3),t.Y8G("heading",t.bMT(46,69,"marketing.usage-limit"))("sort",i.sorts.get("usageLimit"))("hiddenByDefault",!0),t.R7$(3),t.Y8G("ngForOf",i.customFields))},dependencies:[f.U4n,p.Sq,p.bT,T.Wk,u.nG,u.wL,u.TX,_.l,ut.w,y.t,k.p,D.T,gt.T,ft.I,ht.Y,vt.E,bt.T,A.e,p.Jj,$.D9,Ct.P],styles:[".search-form[_ngcontent-%COMP%]{padding:0}.search-input[_ngcontent-%COMP%]{margin:6px 8px 0 0;min-width:200px}"],changeDetection:0})}const j=e=>[{path:"promotions",component:s.H1b,data:{locationId:"promotion-list",breadcrumb:(0,d.x)("breadcrumb.promotions")},children:e.getPageTabRoutes("promotion-list")},{path:"promotions/:id",component:s.H1b,data:{locationId:"promotion-detail",breadcrumb:{label:(0,d.x)("breadcrumb.promotions"),link:["../","promotions"]}},children:e.getPageTabRoutes("promotion-detail")}];function Ot(e,o){return(0,s.bv4)({entity:e.entity,id:o.id,breadcrumbKey:"breadcrumb.promotions",getName:n=>n.name,route:"promotions"})}class g{static#t=this.hasRegisteredTabsAndBulkActions=!1;constructor(o,n){g.hasRegisteredTabsAndBulkActions||(o.registerBulkAction(G),o.registerBulkAction(N),o.registerBulkAction(L),o.registerBulkAction(R),n.registerPageTab({priority:0,location:"promotion-list",tab:(0,d.x)("breadcrumb.promotions"),route:"",component:v}),n.registerPageTab({priority:0,location:"promotion-detail",tab:(0,d.x)("marketing.promotion"),route:"",component:(0,s.HL6)({component:h,query:s.CuV,entityKey:"promotion",getBreadcrumbs:i=>[{label:i?i.name:(0,d.x)("marketing.create-new-promotion"),link:[i?.id]}]})}),g.hasRegisteredTabsAndBulkActions=!0)}static#o=this.\u0275fac=function(n){return new(n||g)(t.KVO(s.HCh),t.KVO(s.bPm))};static#n=this.\u0275mod=t.$C({type:g});static#e=this.\u0275inj=t.G2t({providers:[{provide:T.bw,useFactory:o=>j(o),multi:!0,deps:[s.bPm]}],imports:[s.GgS,T.iI.forChild([]),s.GgS,s.GgS]})}}}]);